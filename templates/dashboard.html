<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RxForecaster - Supply Chain Management Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/medical-theme.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-brand">
                <div class="header-icon">
                    <i data-lucide="package"></i>
                </div>
                <div>
                    <h1 class="header-title">RxForecaster</h1>
                    <p class="header-subtitle">Advanced Supply Chain Management Dashboard</p>
                </div>
            </div>
            <div class="header-status">
                <div class="status-dot"></div>
                <span>System Online - Ready for Operations</span>
            </div>
        </div>
    </header>

    <!-- Control Panel -->
    <div class="container">
        <div class="control-panel">
            <div class="control-grid">
                <div class="control-item">
                    <label class="control-label">Time Range: <span id="time-range-value">30</span> days</label>
                    <input type="range" id="time-range" class="slider" min="7" max="365" value="30">
                </div>
                <div class="control-item">
                    <label class="control-label">Forecast Horizon: <span id="forecast-horizon-value">12</span> weeks</label>
                    <input type="range" id="forecast-horizon" class="slider" min="1" max="52" value="12">
                </div>
                <div class="control-item">
                    <label class="control-label">Alert Sensitivity: <span id="alert-sensitivity-value">50</span>%</label>
                    <input type="range" id="alert-sensitivity" class="slider" min="0" max="100" value="50">
                </div>
                <div class="control-item">
                    <label class="control-label">Drug Filter</label>
                    <select id="drug-filter" class="select">
                        <option value="all">All Drugs</option>
                        <option value="morphine">Morphine</option>
                        <option value="paracetamol">Paracetamol</option>
                        <option value="insulin">Insulin</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label class="control-label">Drug Search</label>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <input 
                            type="text" 
                            id="drug-search" 
                            placeholder="Enter drug name..." 
                            class="input"
                            style="flex: 1; margin: 0;"
                        />
                        <button id="search-drug-btn" class="btn btn-blue" style="padding: 0.5rem 1rem; margin: 0;">
                            <i data-lucide="search" style="width: 16px; height: 16px;"></i>
                            Search
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="container">
        <div class="dashboard-grid">
            
            <!-- System Overview -->
            <div class="dashboard-card card-green">
                <div class="card-header">
                    <h2 class="card-title">System Overview</h2>
                    <i data-lucide="activity" class="card-icon" style="color: var(--green-600);"></i>
                </div>
                <p class="card-text">Your RxForecaster system is running successfully with all core features operational.</p>
                
                <ul class="card-features">
                    <li><span class="feature-dot"></span><span id="count-drugs">30</span> Hospital Drugs Loaded</li>
                    <li><span class="feature-dot"></span><span id="count-weeks">52</span> Weeks Historical Data</li>
                    <li><span class="feature-dot"></span><span id="count-depts">7</span> Departments Active</li>
                    <li><span class="feature-dot"></span>Real-time Forecasting Ready</li>
                </ul>
                
                <button class="btn btn-green">Check System Health</button>
            </div>

            <!-- Drug Inventory -->
            <div class="dashboard-card card-blue">
                <div class="card-header">
                    <h2 class="card-title">Drug Inventory</h2>
                    <i data-lucide="package" class="card-icon" style="color: var(--blue-600);"></i>
                </div>
                <p class="card-text">View and manage your complete pharmaceutical inventory with risk assessments.</p>
                
                <div id="inventory-list" style="max-height: 12rem; overflow-y: auto; margin-bottom: 1rem;">
                    <!-- Inventory items will be populated by JS -->
                </div>
                
                <div>
                    <button class="btn btn-blue">View All Drugs</button>
                    <button class="btn btn-red">ICU Drugs</button>
                </div>
            </div>

            <!-- Critical Alerts -->
            <div class="dashboard-card card-red">
                <div class="card-header">
                    <h2 class="card-title">Critical Alerts</h2>
                    <i data-lucide="alert-triangle" class="card-icon" style="color: var(--red-600);"></i>
                </div>
                <p class="card-text">Monitor drugs at critical risk levels requiring immediate attention.</p>
                
                <div class="grid-2">
                    <div class="alert-box">
                        <div class="alert-number" id="critical-count">3</div>
                        <div class="alert-text">Critical Risk Drugs</div>
                    </div>
                    <div class="alert-box warning">
                        <div class="alert-number" id="high-count">7</div>
                        <div class="alert-text">High Risk Drugs</div>
                    </div>
                </div>
                
                <div id="risk-chart" class="chart-container-xl" style="height: 500px;"></div>
            </div>

            <!-- Demand Forecasting -->
            <div class="dashboard-card card-purple col-span-2">
                <div class="card-header">
                    <h2 class="card-title">Demand Forecasting</h2>
                    <i data-lucide="trending-up" class="card-icon" style="color: var(--purple-600);"></i>
                </div>
                <p class="card-text">Generate AI-powered demand forecasts using FB Prophet and ARIMA models.</p>
                
                <div id="forecast-chart" class="chart-container-xl" style="height: 400px;"></div>
                
                <div>
                    <button class="btn btn-blue">Morphine Forecast</button>
                    <button class="btn btn-purple">Paracetamol Forecast</button>
                    <button class="btn btn-green">Insulin Forecast</button>
                </div>
            </div>

            <!-- Anomaly Detection -->
            <div class="dashboard-card card-yellow">
                <div class="card-header">
                    <h2 class="card-title">Anomaly Detection</h2>
                    <i data-lucide="search" class="card-icon" style="color: var(--yellow-600);"></i>
                </div>
                <p class="card-text">Detect unusual demand patterns and potential supply disruptions.</p>
                
                <div id="anomaly-chart" class="chart-container-xl" style="height: 450px; margin-bottom: 1rem;">
                    <!-- Anomaly detection chart will be populated by JS -->
                </div>
                
                <div id="anomaly-list" style="margin-bottom: 1rem; max-height: 120px; overflow-y: auto;">
                    <!-- Anomaly items will be populated by JS -->
                </div>
                
                <div>
                    <button class="btn btn-yellow">Analyze All Drugs</button>
                    <button class="btn btn-blue">Advanced Analysis</button>
                </div>
            </div>

            <!-- Reorder Management -->
            <div class="dashboard-card card-indigo col-span-2">
                <div class="card-header">
                    <h2 class="card-title">Reorder Management</h2>
                    <i data-lucide="refresh-cw" class="card-icon" style="color: var(--indigo-600);"></i>
                </div>
                <p class="card-text">Generate comprehensive reorder recommendations with cost analysis.</p>
                
                <div class="grid-2">
                    <div>
                        <h4 class="chart-title">Department Usage</h4>
                        <div id="dept-chart" class="chart-container-large" style="height: 250px;"></div>
                    </div>
                    <div>
                        <h4 class="chart-title">Budget Analysis</h4>
                        <div id="budget-chart" class="chart-container-large" style="height: 250px;"></div>
                    </div>
                </div>
                
                <div>
                    <button class="btn btn-indigo">Generate Report</button>
                    <button class="btn btn-gray">
                        <i data-lucide="download" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></i>
                        Download CSV
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Separate Business Analysis Section -->
    <div class="container" style="margin-top: 3rem;">
        <div class="section-header">
            <h2 class="section-title">📊 Business Intelligence & Analytics</h2>
            <p class="section-subtitle">Comprehensive financial and operational insights for strategic decision making</p>
        </div>
        
        <div class="business-grid">
            <!-- Enhanced Department Analytics -->
            <div class="dashboard-card card-indigo mega-card">
                <div class="card-header">
                    <h2 class="card-title">Department Performance Analytics</h2>
                    <i data-lucide="bar-chart-3" class="card-icon" style="color: var(--indigo-600);"></i>
                </div>
                <p class="card-text">Detailed analysis of drug usage patterns, efficiency metrics, and departmental comparisons.</p>
                
                <div id="dept-performance-chart" class="chart-container-xl" style="height: 450px; margin-bottom: 1rem;"></div>
                
                <div class="analytics-controls">
                    <button class="btn btn-indigo">Department Report</button>
                    <button class="btn btn-blue">Usage Trends</button>
                    <button class="btn btn-green">Efficiency Metrics</button>
                </div>
        </div>
        
            <!-- Enhanced Financial Analysis -->
            <div class="dashboard-card card-cyan mega-card">
                <div class="card-header">
                    <h2 class="card-title">Financial Budget Analysis</h2>
                    <i data-lucide="dollar-sign" class="card-icon" style="color: var(--cyan-600);"></i>
        </div>
                <p class="card-text">Comprehensive budget tracking, variance analysis, and cost optimization insights.</p>
                
                <div id="budget-performance-chart" class="chart-container-xl" style="height: 450px; margin-bottom: 1rem;"></div>
                
                <div class="analytics-controls">
                    <button class="btn btn-cyan">Budget Report</button>
                    <button class="btn btn-indigo">Cost Analysis</button>
                    <button class="btn btn-gray">
                        <i data-lucide="download" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></i>
                        Export Financial Data
                    </button>
                </div>
        </div>
        
            <!-- Supply Chain Optimization -->
            <div class="dashboard-card card-teal mega-card">
                <div class="card-header">
                    <h2 class="card-title">Supply Chain Optimization</h2>
                    <i data-lucide="truck" class="card-icon" style="color: var(--teal-600);"></i>
        </div>
                <p class="card-text">Advanced analytics for supplier performance, lead times, and inventory optimization.</p>
                
                <div id="supply-chain-chart" class="chart-container-xl" style="height: 450px; margin-bottom: 1rem;"></div>
                
                <div class="analytics-controls">
                    <button class="btn btn-teal">Supplier Analysis</button>
                    <button class="btn btn-blue">Lead Time Optimization</button>
                    <button class="btn btn-green">Inventory Optimization</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Slider value updates
        function updateSliderValues() {
            document.getElementById('time-range-value').textContent = document.getElementById('time-range').value;
            document.getElementById('forecast-horizon-value').textContent = document.getElementById('forecast-horizon').value;
            document.getElementById('alert-sensitivity-value').textContent = document.getElementById('alert-sensitivity').value;
        }

        // Add event listeners to sliders
        document.addEventListener('DOMContentLoaded', function() {
            const sliders = ['time-range', 'forecast-horizon', 'alert-sensitivity'];
            sliders.forEach(id => {
                const slider = document.getElementById(id);
                if (slider) {
                    slider.addEventListener('input', updateSliderValues);
                }
            });
            updateSliderValues();
        });

        // Auto-refresh status every 30 seconds
        setInterval(function() {
            fetch('/api/v1/health')
                .then(response => response.json())
                .then(data => {
                    console.log('System status:', data.status);
                })
                .catch(error => {
                    console.log('System may be offline');
                });
        }, 30000);
    </script>
</body>
</html>